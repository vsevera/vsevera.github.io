<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>VSEVERA ‚Äî –º–∏–Ω–∏-–º–∞–≥–∞–∑–∏–Ω</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
/* === –ë—Ä–µ–Ω–¥–æ–≤—ã–µ —Ü–≤–µ—Ç–∞ VSEVERA (—Å—Ç—Ä–æ–≥–æ –ø–æ –∑–∞–¥–∞–Ω–∏—é) ===
   –ü–µ—Å–æ—á–Ω—ã–π       #E8D3B5
   –õ–∞–∑—É—Ä–Ω—ã–π       #4AB7B6
   –ì–ª—É–±–æ–∫–∏–π —Å–∞–ø—Ñ–∏—Ä#1A3D5D
   –†–æ–∑–æ–≤—ã–π –∫–≤–∞—Ä—Ü  #F2C1B6
   –°–µ—Ä—ã–π –∫–∞–º–µ–Ω—å   #8A8A8A
*/
:root{
  --sand: #E8D3B5;
  --azure: #4AB7B6;
  --sapphire: #1A3D5D;
  --rose: #F2C1B6;
  --stone: #8A8A8A;

  --bg: #FBF8F5; /* –º—è–≥–∫–∏–π —Ñ–æ–Ω, –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π ‚Äî —Å–æ—Ö—Ä–∞–Ω–∏–º —á–∏—Ç–∞–µ–º–æ—Å—Ç—å */
  --card-bg: #FFFFFF;
  --muted: var(--stone);
  --radius: 12px;
}

*{box-sizing:border-box}
body {
  font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  margin:0;
  background: linear-gradient(180deg, var(--bg) 0%, #fff 100%);
  color: #111;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
}

.wrap { padding:18px; max-width:760px; margin:0 auto; }

header {
  display:flex;
  align-items:center;
  gap:12px;
  margin-bottom:8px;
}
.logo {
  width:48px; height:48px; border-radius:10px;
  background: linear-gradient(135deg, var(--sapphire), var(--azure));
  display:flex; align-items:center; justify-content:center;
  color:#fff; font-weight:700; font-size:18px;
  box-shadow: 0 6px 18px rgba(26,61,93,0.12);
}
h1 {
  margin:0; font-size:18px; color:var(--sapphire);
  letter-spacing:0.2px;
}

.products { display:grid; gap:14px; margin-top:10px; }
.card {
  background:var(--card-bg);
  border-radius:var(--radius);
  overflow:hidden;
  box-shadow: 0 6px 20px rgba(26,61,93,0.06);
  border:1px solid rgba(26,61,93,0.04);
}

.media { position:relative; width:100%; height:200px; background:#f2f2f2; }
.media img, .media video { width:100%; height:100%; object-fit:cover; display:block; }
.badge {
  position:absolute; left:12px; top:12px;
  background:var(--azure); color:#fff; padding:6px 10px; border-radius:999px;
  font-size:13px; font-weight:600; box-shadow:0 6px 16px rgba(74,183,182,0.12);
}

.inner { padding:14px; }
.title { font-size:16px; margin:0 0 6px; color:var(--sapphire); font-weight:700; }
.desc { margin:0 0 8px; color:var(--muted); font-size:14px; line-height:1.35;}
.row { display:flex; justify-content:space-between; align-items:center; gap:10px; margin-top:6px; }

.price { font-weight:800; color:var(--sapphire); font-size:16px; }
.qty { display:flex; align-items:center; gap:8px; }
.qty button {
  width:32px; height:32px; border-radius:8px; border:0; background:var(--bg); color:var(--sapphire);
  font-size:18px; cursor:pointer;
  box-shadow: inset 0 -2px 0 rgba(0,0,0,0.03);
}
.qty span { min-width:26px; text-align:center; font-weight:600; color:#222; display:inline-block; }

.btn {
  background: var(--sapphire);
  color:#fff; border:0; padding:10px 14px; border-radius:10px; cursor:pointer; font-weight:700;
  box-shadow: 0 8px 18px rgba(26,61,93,0.12); transition: transform .12s ease, background .12s;
}
.btn:hover { transform: translateY(-2px); background: var(--azure); color:#07303a; }

.btn.secondary {
  background: transparent; color:var(--sapphire); border:1px solid rgba(26,61,93,0.08); font-weight:700;
}
.btn.ghost {
  background: var(--rose); color:var(--sapphire);
}

.hint { font-size:13px; color:var(--muted); margin-top:6px; }

/* Cart sticky footer */
#cart {
  position:sticky; bottom:0; background:var(--card-bg); padding:12px 0; display:none;
  box-shadow: 0 -8px 24px rgba(26,61,93,0.06); border-top: 4px solid var(--sapphire);
}
.cart-inner { max-width:760px; margin:0 auto; padding:10px 18px; display:grid; gap:10px; background:transparent; }

/* inputs */
input, select { padding:10px 12px; border-radius:10px; border:1px solid rgba(26,61,93,0.06); background:#fff; font-size:14px; color:#111; }
input::placeholder { color: #a7a7a7; }

/* responsive niceties */
@media (max-width:520px){
  .media { height:160px; }
  .wrap { padding:12px; }
}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="logo">VS</div>
    <div>
      <h1>VSEVERA ‚Äî –ú–∞–≥–∞–∑–∏–Ω –Ω–∞–±–æ—Ä–æ–≤ –∏ –∫–≤–µ—Å—Ç–æ–≤</h1>
      <div class="hint">–ö–∞–º–Ω–∏-—Å–∞–º–æ—Ü–≤–µ—Ç—ã ‚Ä¢ –°–µ–Ω—Å–æ—Ä–∏–∫–∞ ‚Ä¢ –ù–µ–π—Ä–æ–∏–≥—Ä—ã</div>
    </div>
  </header>

  <div class="products" id="products"></div>
</div>

<!-- Cart -->
<div id="cart">
  <div class="cart-inner">
    <div style="display:flex; justify-content:space-between; align-items:center;">
      <div style="font-weight:700">üß∫ –í –∫–æ—Ä–∑–∏–Ω–µ: <span id="count">0</span></div>
      <div style="font-weight:800; color:var(--sapphire)">–ò—Ç–æ–≥–æ: <span id="total">0</span> ‚ÇΩ</div>
    </div>

    <div style="display:grid; grid-template-columns:1fr auto; gap:8px;">
      <input id="promo" placeholder="–ü—Ä–æ–º–æ–∫–æ–¥">
      <button class="btn secondary" onclick="applyPromo()">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
    </div>

    <div style="display:grid; grid-template-columns:1fr 1fr; gap:8px;">
      <select id="shipping" onchange="updateCart()">
        <option value="pickup">–°–∞–º–æ–≤—ã–≤–æ–∑ ‚Äî 0 ‚ÇΩ</option>
        <option value="post">–ü–æ—á—Ç–∞ –†–§ ‚Äî 200 ‚ÇΩ</option>
        <option value="cdek">–°–î–≠–ö ‚Äî 350 ‚ÇΩ</option>
      </select>
      <input id="phone" type="tel" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω –¥–ª—è —Å–≤—è–∑–∏">
    </div>

    <div id="addressBlock" style="display:grid; grid-template-columns:1fr 1fr; gap:8px;">
      <input id="city" placeholder="–ì–æ—Ä–æ–¥">
      <input id="address" placeholder="–ê–¥—Ä–µ—Å (—É–ª–∏—Ü–∞, –¥–æ–º, –∫–≤.)">
    </div>
    <div class="hint" id="addressHint">–î–ª—è —Å–∞–º–æ–≤—ã–≤–æ–∑–∞ –∞–¥—Ä–µ—Å –Ω–µ –Ω—É–∂–µ–Ω</div>

    <div style="display:flex; gap:8px; justify-content:space-between; align-items:center;">
      <button class="btn ghost" onclick="clearCart()">–û—á–∏—Å—Ç–∏—Ç—å</button>
      <button class="btn" onclick="checkout()">–û—Ñ–æ—Ä–º–∏—Ç—å –∏ –æ–ø–ª–∞—Ç–∏—Ç—å</button>
    </div>
  </div>
</div>

<script>
/* --- –ª–æ–≥–∏–∫–∞ WebApp ‚Äî –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π, —Ç–æ–ª—å–∫–æ —Ü–≤–µ—Ç–∞ UI --- */
const tg = window.Telegram.WebApp;
tg.expand();

/* === –¢–æ–≤–∞—Ä—ã: –∑–∞–º–µ–Ω–∏—Ç–µ img/video/poster URL –Ω–∞ —Å–≤–æ–∏ === */
const PRODUCTS = [
  { id:'kit_minerals', title:'–í –ø–æ–∏—Å–∫–∞—Ö —Å–æ–∫—Ä–æ–≤–∏—â', desc:'–ù–∞–±–æ—Ä —Å –Ω–∞—Ç—É—Ä–∞–ª—å–Ω—ã–º–∏ —Å–∞–º–æ—Ü–≤–µ—Ç–∞–º–∏ –∏ –º–∏–Ω–µ—Ä–∞–ª–∞–º–∏', price:2500, img:'https://drive.google.com/drive/u/0/folders/11WShQt5fP98B9vAyCtkTZRJLxEGQnO2N', video:'https://drive.google.com/drive/u/0/folders/1Is5LvxiAZ4UaXTX-964Aaj1sF6l3tUwf', poster:'https://drive.google.com/drive/u/0/folders/1Is5LvxiAZ4UaXTX-964Aaj1sF6l3tUwf' },
  { id:'sand_skazka', title:'–°–∞–º–æ—Ü–≤–µ—Ç—ã 10 –≥ ¬´–°–ö–ê–ó–ö–ê¬ª + 5 —É—Ä–æ–∫–æ–≤', desc:'–ù–∞—Ç—É—Ä–∞–ª—å–Ω—ã–µ –º–∏–Ω–µ—Ä–∞–ª—ã', price:1300, img:'https://drive.google.com/drive/u/0/folders/1McY1V5u8pguZkwi8s2-my8CdtC1orJMG' },
  { id:'family_quest', title:'–°–µ–º–µ–π–Ω—ã–π –∫–≤–µ—Å—Ç ¬´–û—Ç–∫—Ä–æ–π –∫–∞–º–µ–Ω—å¬ª', desc:'–ò–≥—Ä–∞-–∫–≤–µ—Å—Ç –¥–ª—è –≤—Å–µ–π —Å–µ–º—å–∏', price:1500, img:'https://cdn.yoursite/family_quest.jpg', video:'https://cdn.yoursite/family_quest.mp4', poster:'https://cdn.yoursite/family_quest_poster.jpg' },
  { id:'sand_volshebstvo', title:'–°–∞–º–æ—Ü–≤–µ—Ç—ã 10 –≥ ¬´–í–û–õ–®–ï–ë–°–¢–í–û¬ª + 5 —É—Ä–æ–∫–æ–≤', desc:'–ù–∞—Ç—É—Ä–∞–ª—å–Ω—ã–µ –º–∏–Ω–µ—Ä–∞–ª—ã', price:1300, img:'https://cdn.yoursite/sand_volshebstvo.jpg' },
  { id:'sand_magia', title:'–°–∞–º–æ—Ü–≤–µ—Ç—ã 10 –≥ ¬´–ú–ê–ì–ò–Ø¬ª + 5 —É—Ä–æ–∫–æ–≤', desc:'–ù–∞—Ç—É—Ä–∞–ª—å–Ω—ã–µ –º–∏–Ω–µ—Ä–∞–ª—ã', price:1300, img:'https://cdn.yoursite/sand_magia.jpg' }
];

const SHIPPING = {
  pickup: { id:'pickup', title:'–°–∞–º–æ–≤—ã–≤–æ–∑', amount:0 },
  post:   { id:'post', title:'–ü–æ—á—Ç–∞ –†–§', amount:200 },
  cdek:   { id:'cdek', title:'–°–î–≠–ö', amount:350 }
};

let cart = new Map();
let discount = 0;
let promoCode = null;

function el(html){ const d=document.createElement('div'); d.innerHTML=html.trim(); return d.firstChild; }

function renderProducts(){
  const box=document.getElementById('products');
  box.innerHTML='';
  PRODUCTS.forEach(p=>{
    const card=document.createElement('div');
    card.className='card';
    const hasVideo = !!p.video;
    const media = hasVideo
      ? `<video controls preload="none" ${p.poster?`poster="${p.poster}"`:''} src="${p.video}"></video><div class="badge">–í–∏–¥–µ–æ</div>`
      : `<img src="${p.img}" alt="${p.title}" loading="lazy">`;
    card.innerHTML = `
      <div class="media">${media}</div>
      <div class="inner">
        <div class="title">${p.title}</div>
        <div class="desc">${p.desc}</div>
        <div class="row">
          <div class="price">${p.price} ‚ÇΩ</div>
          <div class="qty" id="qty_${p.id}">
            <button onclick="dec('${p.id}')">‚àí</button>
            <span id="q_${p.id}">${cart.get(p.id)?.qty||0}</span>
            <button onclick="inc('${p.id}')">+</button>
          </div>
        </div>
      </div>
    `;
    box.appendChild(card);
  });
}

function inc(id){
  const p = PRODUCTS.find(x=>x.id===id);
  const cur = cart.get(id) || {...p, qty:0};
  cur.qty += 1;
  cart.set(id, cur);
  if (tg.HapticFeedback && tg.HapticFeedback.impactOccurred) {
    try { tg.HapticFeedback.impactOccurred('light'); } catch(e){}
  }
  updateCart();
}
function dec(id){
  const cur = cart.get(id);
  if(!cur) return;
  cur.qty -= 1;
  if(cur.qty <= 0) cart.delete(id);
  else cart.set(id, cur);
  updateCart();
}
function clearCart(){ cart.clear(); updateCart(); }

function getSubtotal(){
  let subtotal=0;
  for(const i of cart.values()) subtotal += i.price * i.qty;
  if(discount>0) subtotal = Math.round(subtotal * (1 - discount/100));
  return subtotal;
}
function getShippingAmount(){ const key = document.getElementById('shipping').value; return SHIPPING[key].amount || 0; }

function updateCart(){
  PRODUCTS.forEach(p=>{
    const el = document.getElementById('q_'+p.id);
    if(el) el.textContent = cart.get(p.id)?.qty || 0;
  });
  let count = 0;
  for(const i of cart.values()) count += i.qty;
  const subtotal = getSubtotal();
  const shippingAmt = getShippingAmount();
  const total = subtotal + shippingAmt;
  document.getElementById('count').textContent = count;
  document.getElementById('total').textContent = total.toString();
  document.getElementById('cart').style.display = count>0 ? 'block' : 'none';
  const isPickup = document.getElementById('shipping').value === 'pickup';
  document.getElementById('addressBlock').style.display = isPickup ? 'none' : 'grid';
  document.getElementById('addressHint').textContent = isPickup ? '–î–ª—è —Å–∞–º–æ–≤—ã–≤–æ–∑–∞ –∞–¥—Ä–µ—Å –Ω–µ –Ω—É–∂–µ–Ω' : '–£–∫–∞–∂–∏—Ç–µ –≥–æ—Ä–æ–¥ –∏ –∞–¥—Ä–µ—Å –¥–ª—è –¥–æ—Å—Ç–∞–≤–∫–∏';
}

function applyPromo(){
  const code = document.getElementById('promo').value.trim().toUpperCase();
  if(code === 'VSEVERA10'){ discount = 10; promoCode = code; alert('–°–∫–∏–¥–∫–∞ 10% –ø—Ä–∏–º–µ–Ω–µ–Ω–∞!'); }
  else { discount = 0; promoCode = null; alert('–ù–µ–≤–µ—Ä–Ω—ã–π –ø—Ä–æ–º–æ–∫–æ–¥'); }
  updateCart();
}

function checkout(){
  const phone = document.getElementById('phone').value.trim();
  const shipId = document.getElementById('shipping').value;
  const isPickup = shipId === 'pickup';
  const city = document.getElementById('city').value.trim();
  const address = document.getElementById('address').value.trim();
  if(!phone){ alert('–í–≤–µ–¥–∏—Ç–µ —Ç–µ–ª–µ—Ñ–æ–Ω –¥–ª—è —Å–≤—è–∑–∏'); return; }
  if(!isPickup && (!city || !address)){ alert('–í–≤–µ–¥–∏—Ç–µ –≥–æ—Ä–æ–¥ –∏ –∞–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏'); return; }
  const items = Array.from(cart.values()).map(i=>({ id:i.id, title:i.title, price:i.price, qty:i.qty }));
  if(items.length === 0){ alert('–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞'); return; }
  const order = {
    type:'order',
    order_id:'ORD'+Date.now(),
    items,
    promo: promoCode,
    discount,
    shippingId: shipId,
    contact:{ phone },
    address: isPickup ? null : { city, address },
    totalsPreview: { subtotal: getSubtotal(), shipping: getShippingAmount(), total: getSubtotal()+getShippingAmount() },
    user: Telegram.WebApp.initDataUnsafe?.user || null
  };
  // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –±–æ—Ç—É (bot –ø–æ–ª—É—á–∏—Ç update.message.web_app_data)
  Telegram.WebApp.sendData(JSON.stringify(order));
}

/* –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è */
renderProducts();
updateCart();
</script>
</body>
</html>
