<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>VSEVERA Shop</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
body { font-family: system-ui; margin:0; background:#f7f7f8; }
.wrap { padding:16px; max-width:640px; margin:0 auto; }
h2 { text-align:center; margin-bottom:16px; }
.products { display:grid; gap:12px; }
.card { background:#fff; border-radius:14px; padding:14px; box-shadow:0 2px 10px rgba(0,0,0,.06); }
.title { font-weight:700; }
.desc { font-size:14px; color:#555; margin:4px 0; }
.row { display:flex; justify-content:space-between; align-items:center; margin-top:10px; }
.price { font-weight:700; }
.btn { background:#0088cc; color:#fff; border:0; padding:8px 12px; border-radius:10px; cursor:pointer; }
.qty { display:flex; align-items:center; gap:8px; }
.qty button { width:28px; height:28px; border-radius:8px; border:0; background:#efefef; }
#cart { position:sticky; bottom:0; background:#fff; padding:12px; box-shadow:0 -6px 18px rgba(0,0,0,.08); display:none; }
#cart input { padding:6px 8px; border-radius:6px; border:1px solid #ccc; width:120px; margin-right:8px; }
</style>
</head>
<body>
<div class="wrap">
<h2>ðŸ›’ ÐœÐ°Ð³Ð°Ð·Ð¸Ð½ VSEVERA</h2>
<div class="products" id="products"></div>
</div>

<div id="cart">
<div class="wrap" style="display:flex; flex-direction:column; gap:6px;">
<div style="display:flex; justify-content:space-between; align-items:center;">
<div>ðŸ§º Ð’ ÐºÐ¾Ñ€Ð·Ð¸Ð½Ðµ: <span id="count">0</span> â€¢ Ð˜Ñ‚Ð¾Ð³Ð¾: <span id="total">0</span> â‚½</div>
<button class="btn" onclick="checkout()">ÐžÑ„Ð¾Ñ€Ð¼Ð¸Ñ‚ÑŒ</button>
</div>
<div style="display:flex; gap:6px;">
<input type="text" id="promo" placeholder="ÐŸÑ€Ð¾Ð¼Ð¾ÐºÐ¾Ð´">
<button class="btn" onclick="applyPromo()">ÐŸÑ€Ð¸Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ</button>
</div>
<div>
<input type="text" id="city" placeholder="Ð“Ð¾Ñ€Ð¾Ð´">
<input type="text" id="address" placeholder="ÐÐ´Ñ€ÐµÑ Ð´Ð¾ÑÑ‚Ð°Ð²ÐºÐ¸">
</div>
</div>
</div>

<script>
const tg = window.Telegram.WebApp;
tg.expand();

const PRODUCTS = [
{id:'kit_minerals',title:'Ð’ ÐŸÐ¾Ð¸ÑÐºÐ°Ñ… Ð¡Ð¾ÐºÑ€Ð¾Ð²Ð¸Ñ‰',desc:'Ð˜Ð³Ñ€Ð¾Ð²Ð¾Ð¹ Ñ€Ð°Ð·Ð²Ð¸Ð²Ð°ÑŽÑ‰Ð¸Ð¹ Ð½Ð°Ð±Ð¾Ñ€ Ñ Ð½Ð°Ñ‚ÑƒÑ€Ð°Ð»ÑŒÐ½Ñ‹Ð¼Ð¸ ÐºÐ°Ð¼Ð½ÑÐ¼Ð¸ ÑÐ°Ð¼Ð¾Ñ†Ð²ÐµÑ‚Ð°Ð¼Ð¸ Ð¸ Ð¼Ð¸Ð½ÐµÑ€Ð°Ð»Ð°Ð¼Ð¸',price:2500},
{id:'sensory_sand',title:'Ð¡ÐµÐ½ÑÐ¾Ñ€Ð½Ñ‹Ð¹ Ð½Ð°Ð±Ð¾Ñ€ Â«ÐÐ°Ð±Ð¾Ñ€ ÑÐ°Ð¼Ð¾Ñ†Ð²ÐµÑ‚Ð¾Ð² 10 Ð³Ñ€. "Ð¡ÐšÐÐ—ÐšÐ" Ñ 5-ÑŽ Ð¾Ð½Ð»Ð°Ð¹Ð½ ÑƒÑ€Ð¾ÐºÐ°Ð¼Ð¸ Ð´Ð»Ñ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸ÑÂ»',desc:'ÐÐ°Ñ‚ÑƒÑ€Ð°Ð»ÑŒÐ½Ñ‹Ðµ Ð¼Ð¸Ð½ÐµÑ€Ð°Ð»Ñ‹',price:1300},
{id:'family_quest',title:'Ð¡ÐµÐ¼ÐµÐ¹Ð½Ñ‹Ð¹ ÐºÐ²ÐµÑÑ‚ Â«ÐžÑ‚ÐºÑ€Ð¾Ð¹ ÐºÐ°Ð¼ÐµÐ½ÑŒÂ»',desc:'Ð˜Ð³Ñ€Ð°-ÐºÐ²ÐµÑÑ‚ Ð´Ð»Ñ Ð²ÑÐµÐ¹ ÑÐµÐ¼ÑŒÐ¸',price:1500},
{id:'sensory_sand',title:'Ð¡ÐµÐ½ÑÐ¾Ñ€Ð½Ñ‹Ð¹ Ð½Ð°Ð±Ð¾Ñ€ Â«ÐÐ°Ð±Ð¾Ñ€ ÑÐ°Ð¼Ð¾Ñ†Ð²ÐµÑ‚Ð¾Ð² 10 Ð³Ñ€. "Ð’ÐžÐ›Ð¨Ð•Ð‘Ð¡Ð¢Ð’Ðž" Ñ 5-ÑŽ Ð¾Ð½Ð»Ð°Ð¹Ð½ ÑƒÑ€Ð¾ÐºÐ°Ð¼Ð¸ Ð´Ð»Ñ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸ÑÂ»',desc:'ÐÐ°Ñ‚ÑƒÑ€Ð°Ð»ÑŒÐ½Ñ‹Ðµ Ð¼Ð¸Ð½ÐµÑ€Ð°Ð»Ñ‹',price:1300},
{id:'sensory_sand',title:'Ð¡ÐµÐ½ÑÐ¾Ñ€Ð½Ñ‹Ð¹ Ð½Ð°Ð±Ð¾Ñ€ Â«ÐÐ°Ð±Ð¾Ñ€ ÑÐ°Ð¼Ð¾Ñ†Ð²ÐµÑ‚Ð¾Ð² 10 Ð³Ñ€. "ÐœÐÐ“Ð˜Ð¯" Ñ 5-ÑŽ Ð¾Ð½Ð»Ð°Ð¹Ð½ ÑƒÑ€Ð¾ÐºÐ°Ð¼Ð¸ Ð´Ð»Ñ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸ÑÂ»',desc:'ÐÐ°Ñ‚ÑƒÑ€Ð°Ð»ÑŒÐ½Ñ‹Ðµ Ð¼Ð¸Ð½ÐµÑ€Ð°Ð»Ñ‹',price:1300}
];

let cart = new Map();
let discount = 0;

function renderProducts(){
  const box=document.getElementById('products');
  box.innerHTML='';
  PRODUCTS.forEach(p=>{
    const card=document.createElement('div');
    card.className='card';
    card.innerHTML=`
      <div class="title">${p.title}</div>
      <div class="desc">${p.desc}</div>
      <div class="row">
        <div class="price">${p.price} â‚½</div>
        <div class="qty" id="qty_${p.id}">
          <button onclick="dec('${p.id}')">âˆ’</button>
          <span id="q_${p.id}">${cart.get(p.id)?.qty||0}</span>
          <button onclick="inc('${p.id}')">+</button>
        </div>
      </div>
    `;
    box.appendChild(card);
  });
}

function inc(id){
  const p=PRODUCTS.find(x=>x.id===id);
  const cur=cart.get(id)||{...p,qty:0};
  cur.qty+=1;
  cart.set(id,cur);
  updateCart();
}
function dec(id){
  const cur=cart.get(id);
  if(!cur)return;
  cur.qty-=1;
  if(cur.qty<=0) cart.delete(id);
  else cart.set(id,cur);
  updateCart();
}

function updateCart(){
  PRODUCTS.forEach(p=>{
    const el=document.getElementById('q_'+p.id);
    if(el) el.textContent=cart.get(p.id)?.qty||0;
  });
  let count=0,total=0;
  for(const i of cart.values()){
    count+=i.qty;
    total+=i.price*i.qty;
  }
  if(discount>0) total=Math.round(total*(1-discount/100));
  document.getElementById('count').textContent=count;
  document.getElementById('total').textContent=total.toString();
  document.getElementById('cart').style.display=count>0?'block':'none';
}

function applyPromo(){
  const code=document.getElementById('promo').value.trim().toUpperCase();
  // Ð¿Ñ€Ð¸Ð¼ÐµÑ€: Ð¿Ñ€Ð¾Ð¼Ð¾ÐºÐ¾Ð´ VSEVERA10 Ð´Ð°Ñ‘Ñ‚ ÑÐºÐ¸Ð´ÐºÑƒ 10%
  if(code==='VSEVERA10'){ discount=10; alert('Ð¡ÐºÐ¸Ð´ÐºÐ° 10% Ð¿Ñ€Ð¸Ð¼ÐµÐ½ÐµÐ½Ð°!'); }
  else { discount=0; alert('ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹ Ð¿Ñ€Ð¾Ð¼Ð¾ÐºÐ¾Ð´'); }
  updateCart();
}

function checkout(){
  const city=document.getElementById('city').value.trim();
  const address=document.getElementById('address').value.trim();
  if(!city||!address){ alert('Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð³Ð¾Ñ€Ð¾Ð´ Ð¸ Ð°Ð´Ñ€ÐµÑ Ð´Ð¾ÑÑ‚Ð°Ð²ÐºÐ¸'); return; }
  const order=Array.from(cart.values()).map(i=>({id:i.id,title:i.title,price:i.price,qty:i.qty}));
  tg.sendData(JSON.stringify({type:'order',items:order,city,address,discount}));
}

renderProducts();
updateCart();
</script>
</body>
</html>
